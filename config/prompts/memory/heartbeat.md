# 心跳检查任务定义

## 任务概述

心跳检查是 Nanobot 定期执行的自我评估和状态更新任务，旨在确保系统持续健康运行，及时发现并处理问题，同时优化资源使用。

## 触发条件

### 1. 定期触发
- **常规检查**: 每 30 分钟执行一次全面心跳检查
- **快速检查**: 每 10 分钟执行一次简单状态检查
- **延迟检查**: 当系统响应延迟超过 5 秒时触发
- **资源检查**: 当资源使用率超过阈值时触发

### 2. 事件触发
- **任务完成后**: 执行任务完成后的健康检查
- **错误发生后**: 出现错误或异常时触发检查
- **配置变更后**: 系统配置修改后触发验证检查
- **资源变化后**: 资源分配或使用情况显著变化时触发

### 3. 用户触发
- **用户请求**: 用户主动请求执行心跳检查
- **性能问题**: 用户反馈系统性能不佳时触发
- **状态疑问**: 用户询问系统状态时触发检查

## 检查内容

### 1. 系统状态检查
- **运行状态**: 检查 Nanobot 服务是否正常运行
- **响应时间**: 测试系统响应速度和延迟
- **资源使用**: 检查 CPU、内存、磁盘、网络等资源使用情况
- **进程状态**: 检查关键进程是否正常运行

### 2. 记忆系统检查
- **记忆完整性**: 检查记忆文件是否完整、可访问
- **记忆一致性**: 检查短期记忆和长期记忆的一致性
- **记忆容量**: 检查记忆存储是否接近上限
- **检索性能**: 测试记忆检索的速度和准确性

### 3. 功能完整性检查
- **技能可用性**: 检查各技能模块是否正常加载和执行
- **工具可用性**: 检查外部工具和服务是否可访问
- **配置有效性**: 检查系统配置是否有效且完整
- **依赖状态**: 检查依赖的外部资源和服务状态

### 4. 安全状态检查
- **权限验证**: 检查系统权限设置是否正确
- **数据安全**: 检查记忆数据是否加密和备份
- **访问控制**: 检查访问控制机制是否正常工作
- **安全日志**: 检查是否有异常访问或安全事件

## 检查流程

### 1. 初始化阶段
- 记录检查开始时间和触发条件
- 收集系统状态快照
- 准备检查所需的工具和资源

### 2. 执行检查阶段
- 依次执行各项检查任务
- 记录每项检查的结果和数据
- 识别潜在问题和异常情况

### 3. 分析阶段
- 分析检查结果，评估系统健康状态
- 确定问题的严重程度和影响范围
- 制定相应的解决方案和优化建议

### 4. 报告阶段
- 生成心跳检查报告
- 记录关键发现和问题
- 提供解决方案和建议

## 检查结果处理

### 1. 健康状态分类
- **完全健康**: 所有检查项均通过，系统运行正常
- **轻微异常**: 存在一些小问题，但不影响系统功能
- **中度异常**: 存在一些问题，可能影响系统性能或功能
- **严重异常**: 存在严重问题，系统功能受到严重影响

### 2. 问题处理策略
- **自动修复**: 对简单问题自动执行修复操作
- **通知用户**: 向用户发送通知，告知问题和解决方案
- **建议操作**: 提供手动操作建议，指导用户修复问题
- **紧急处理**: 对严重问题立即执行紧急处理措施

### 3. 优化建议
- **资源优化**: 建议资源分配和使用的优化方案
- **配置优化**: 建议系统配置的调整方案
- **性能优化**: 建议性能改进和优化策略
- **安全优化**: 建议安全配置和防护的优化方案

## 报告格式

### 1. 基本信息
```markdown
# 心跳检查报告
- 检查时间: [YYYY-MM-DD HH:MM:SS]
- 触发条件: [定期/事件/用户]
- 检查类型: [全面/快速/资源/功能]
- 执行时间: [秒数]
```

### 2. 健康状态评估
```markdown
## 健康状态
- 总体状态: [完全健康/轻微异常/中度异常/严重异常]
- 得分: [0-100分]
- 问题数量: [问题总数]
```

### 3. 详细检查结果
```markdown
## 系统状态
- 运行状态: [正常/异常]
- 响应时间: [毫秒]
- 资源使用:
  - CPU: [使用率%]
  - 内存: [使用量/总量]
  - 磁盘: [可用空间]
  - 网络: [连接状态]

## 记忆系统
- 记忆完整性: [完整/部分缺失/严重缺失]
- 记忆一致性: [一致/部分不一致/严重不一致]
- 记忆容量: [已用空间/总容量]
- 检索性能: [毫秒]

## 功能完整性
- 技能可用性: [全部正常/部分异常/严重异常]
- 工具可用性: [全部正常/部分异常/严重异常]
- 配置有效性: [有效/部分无效/严重无效]
- 依赖状态: [全部正常/部分异常/严重异常]

## 安全状态
- 权限验证: [通过/失败]
- 数据安全: [加密/未加密]
- 访问控制: [正常/异常]
- 安全日志: [无异常/存在异常]
```

### 4. 问题和解决方案
```markdown
## 发现的问题
1. [问题描述]
   - 严重程度: [高/中/低]
   - 影响范围: [系统/功能/性能]
   - 解决方案: [自动修复/手动操作/建议]
2. [问题描述]
   - 严重程度: [高/中/低]
   - 影响范围: [系统/功能/性能]
   - 解决方案: [自动修复/手动操作/建议]
```

### 5. 优化建议
```markdown
## 优化建议
1. [优化内容]
   - 类型: [资源/配置/性能/安全]
   - 建议操作: [具体措施]
   - 预期效果: [改进预期]
2. [优化内容]
   - 类型: [资源/配置/性能/安全]
   - 建议操作: [具体措施]
   - 预期效果: [改进预期]
```

## 存档策略

### 1. 报告存储
- **定期报告**: 保留最近 30 天的心跳检查报告
- **异常报告**: 永久保留严重异常和问题报告
- **用户请求报告**: 保留用户主动请求的检查报告

### 2. 数据统计
- 每月统计系统健康状态趋势
- 分析问题类型和发生频率
- 评估优化措施的效果

### 3. 数据清理
- 定期清理过期的检查报告
- 压缩归档历史数据
- 确保数据存储不超过上限
