# 上下文压缩规则

## 压缩触发条件

### 1. 上下文长度超标
- 单轮对话上下文超过 2000 字符
- 多轮对话历史累计超过 5000 字符
- 代码片段或日志输出过长影响理解

### 2. 信息重复或冗余
- 重复的问题描述和解决方案
- 多次提及相同的代码片段
- 冗余的环境状态信息

### 3. 信息关联性低
- 与当前任务无关的历史对话
- 过时的任务状态和临时信息
- 不相关的学习和探索内容

### 4. 信息优先级评估
- 低优先级的临时数据和状态
- 已解决问题的详细调试过程
- 不再相关的待办事项

## 压缩策略

### 1. 内容筛选
- **保留核心信息**: 任务目标、关键问题、最终解决方案
- **删除冗余信息**: 重复描述、过时状态、无关内容
- **提取关键要点**: 从长文本中提取核心观点和数据

### 2. 结构优化
- **合并相似内容**: 将重复或相关信息合并表述
- **重构逻辑结构**: 优化信息组织方式，提高可读性
- **添加层次标题**: 为压缩后的内容添加适当标题

### 3. 语言精简
- **删除冗余修饰**: 简化复杂句式，保留核心语义
- **使用专业术语**: 用简洁的技术术语替代详细描述
- **压缩代码片段**: 保留关键部分，删除无关代码

### 4. 信息概括
- **总结主要内容**: 用一句话概括长文本核心要点
- **提取关键数据**: 保留重要数值和指标
- **保留关键链接**: 保留参考资源和文档链接

## 压缩格式

### 1. 对话历史压缩
```markdown
# 对话摘要
- 时间范围: [开始-结束时间]
- 核心问题: [主要需求]
- 关键信息: [核心数据]
- 解决方案: [最终方案]
- 待办事项: [后续行动]
```

### 2. 代码片段压缩
```markdown
# 代码功能: [功能描述]
- 核心逻辑: [关键算法/实现思路]
- 主要实现:
  ```python
  # 核心代码片段
  def main():
      # 关键逻辑
      pass
  ```
- 输入输出: [参数/返回值示例]
- 使用场景: [适用条件]
```

### 3. 文档内容压缩
```markdown
# 文档主题: [文档标题]
- 核心观点: [主要结论]
- 关键要点:
  - [要点1]
  - [要点2]
  - [要点3]
- 适用范围: [应用场景]
- 参考资源: [原始文档链接]
```

### 4. 任务状态压缩
```markdown
# 任务: [任务名称]
- 状态: [当前状态]
- 进度: [已完成x%]
- 关键问题: [未解决的核心问题]
- 下一步: [后续行动]
```

## 压缩质量评估

### 1. 完整性检查
- 核心信息是否完整保留
- 关键数据是否准确无误
- 逻辑关系是否清晰明确

### 2. 可读性评估
- 压缩后的内容是否易于理解
- 语言表达是否简洁明了
- 结构组织是否合理清晰

### 3. 实用性评估
- 是否保留了对当前任务有价值的信息
- 是否删除了无关和冗余内容
- 压缩后的内容是否便于检索和使用

## 压缩后处理

### 1. 存储策略
- 压缩后的内容替代原内容存储
- 保留原始内容的备份（可选）
- 为压缩后的内容添加压缩标记

### 2. 检索优化
- 为压缩后的内容添加关键词标签
- 建立压缩内容与原始内容的关联
- 优化搜索和检索机制

### 3. 更新机制
- 当任务状态变化时重新压缩
- 定期检查压缩内容的有效性
- 根据用户反馈调整压缩策略
